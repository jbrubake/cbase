# TODO: Add better instructions on using this Makefile, to include
# TODO: variables and targets that MUST be modified as well as optional
# TODO: settings. Also include basic instructions on editing the *mk
# TODO: files, although more details will be included in the toplevel
# TODO: README

###############################################
# Modify the following variables as necessary.
# At a minimum you need to edit the lines for
# $(SRCFILES), $(HDRFILES) and $(AUXFILES)
#
# You will also need to modify some of the
# make targets below, especially install
###############################################

MODULES  := cbase
# Search for headers in these directories
# You do not need to include directories in
# $(MODULES)
INCLUDES :=

# Include top level sources, headers and any other files
# that should be rolled up in a distro tarball
SRCFILES :=
HDRFILES :=
AUXFILES := AUTHORS ChangeLog INSTALL Makefile NEWS README depend.sh

# Installation directories. Modify as needed
prefix        := $(DESTDIR)/usr/local
exec_prefix   := $(prefix)

bindir        := $(exec_prefix)/bin
sbindir       := $(exec_prefix)/sbin
libexecdir    := $(exec_prefix)/libexec

sysconfdir    := $(prefix)/etc
localstatedir := $(prefix)/var
includedir    := $(prefix)/include
libdir        := $(prefix)/lib
datarootdir   := $(prefix)/share

datadir       := $(datarootdir)
locale        := $(datarootdir)/locale

mandir        := $(datarootdir)/man
man1          := $(mandir)/man1
man1ext       := .1
# And so on for whatever 'man' dirs you need

####################################################
# YOU SHOULD NOT NEED TO MODIFY ANY VARIABLES BELOW
# THIS UNLESS YOU HAVE SOME NON-STANDARD TOOLS
####################################################

INCLUDES += $(patsubst %, -I%, $(MODULES))
-include $(patsubst %, %/module.mk, $(MODULES))
OBJFILES := $(patsubst %.c,%.o, \
		$(filter %.c,$(SRCFILES))) \
	    $(patsubst %.y,%.o, \
		$(filter %.y,$(SRCFILES)))

# Tools
INSTALL         := install
INSTALL_PROGRAM := $(INSTALL)
INSTALL_DATA    := $(INSTALL) -m 644

# Main program and corefile names
EXE      := __EXE__
BASENAME := __PROJECT__
PROGNAME := $(BASENAME)$(EXE)
COREFILE := __COREFILE__

# Variables to set distro tarball name
VERSION := __VERSION__
DISTFILE := $(BASENAME)-$(VERSION).tar.gz

# Flags
CPPFLAGS   := $(CPPFLAGS)
ALL_CFLAGS := $(CFLAGS) -g
LDFLAGS    := $(LDFLAGS)
LIBS       :=

COMPILE := $(CC) -c $(INCLUDES) $(CPPFLAGS) $(ALL_CFLAGS)
LINK    := $(LD) $(LDFLAGS)

.SUFFIXES:
.SUFFIXES: .c .o

.PHONY: all install install-strip uninstall \
    clean distclean mostlyclean maintainer-clean \
    TAGS dist check lint docs \
    notes todo fixme xxx

###################################################
# Modify the make targets below as needed. There is
# NO entry for install, so you probably need to add
# one there at a minimum. The *clean targets have
# sensible defaults, so they may be alright for you
###################################################
all: $(PROGNAME)

$(PROGNAME): $(OBJFILES)
	$(LINK) -o $@ $(OBJFILES)

include $(OBJFILES:.o=.d)

%.d: %.c
	-./depend.sh `dirname $*.c ` $(ALL_CFLAGS) $*.c > $@

.c.o:
	$(COMPILE) -o $@ $<

install:

install-strip:
	@# Do 'make install' but strip executables

uninstall:

clean:
	@# Delete files generated by 'make all'
	-rm $(OBJFILES) $(OBJFILES:.o=.d) $(PROGNAME)

distclean: clean
	@# Delete files generated by 'configure' and 'make all'

mostlyclean:
	@# Like clean but may refrain from deleting files you
	@#   normally don't want to compile

maintainer-clean: distclean
	@# Delete everything the makefile can build except
	@#   'configure' and files 'configure' needs
	@echo 'This command is intended for maintainers to use; it'
	@echo 'deletes files that may require special tools to rebuild'

TAGS:
	@# Generate ctags

dist:
	@# Make a distribution tarball
	-tar -cv $(SRCFILES) $(HDRFILES) $(AUXFILES) | gzip -c -9 > $(DISTFILE)

check:
	@# Perform tests

lint:
	@# Run lint

docs:
	@# Generate documentation

notes: todo fixme xxx
	@# Prints out all TODO, FIXME and XXX comments

todo:
	-@for file in $(SRCFILES) $(HDRFILES); do grep -H TODO  $$file; done; true
fixme:
	-@for file in $(SRCFILES) $(HDRFILES); do grep -H FIXME $$file; done; true
xxx:
	-@for file in $(SRCFILES) $(HDRFILES); do grep -H XXX   $$file; done; true

